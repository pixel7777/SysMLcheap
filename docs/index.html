<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SysMLcheap â€” Model Tables</title>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
  <style>
    :root {
      --bg: #0d1117; --surface: #161b22; --border: #30363d;
      --text: #e6edf3; --muted: #8b949e; --accent: #58a6ff;
      --green: #3fb950; --yellow: #d29922; --red: #f85149;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
           background: var(--bg); color: var(--text); padding: 2rem; line-height: 1.5; }
    h1 { font-size: 1.5rem; margin-bottom: 0.25rem; }
    .subtitle { color: var(--muted); margin-bottom: 1.5rem; font-size: 0.9rem; }
    nav { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
    nav button { background: var(--surface); color: var(--text); border: 1px solid var(--border);
                 padding: 0.4rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
    nav button:hover { border-color: var(--accent); }
    nav button.active { background: var(--accent); color: #fff; border-color: var(--accent); }
    .status { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 12px;
              font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
    .status-mvp { background: rgba(63,185,80,0.15); color: var(--green); }
    .status-future { background: rgba(210,153,34,0.15); color: var(--yellow); }
    .status-deprecated { background: rgba(248,81,73,0.15); color: var(--red); }
    table { width: 100%; border-collapse: collapse; background: var(--surface);
            border-radius: 8px; overflow: hidden; }
    thead { background: rgba(255,255,255,0.04); }
    th { text-align: left; padding: 0.6rem 1rem; font-size: 0.8rem; text-transform: uppercase;
         color: var(--muted); border-bottom: 1px solid var(--border); white-space: nowrap; }
    td { padding: 0.6rem 1rem; border-bottom: 1px solid var(--border);
         font-size: 0.85rem; vertical-align: top; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: rgba(255,255,255,0.02); }
    td.doc { max-width: 420px; color: var(--muted); }
    td.id { font-family: 'SFMono-Regular', Consolas, monospace; font-size: 0.8rem; color: var(--muted); }
    .filter-row { display: flex; gap: 0.75rem; margin-bottom: 1rem; align-items: center; flex-wrap: wrap; }
    .filter-row label { font-size: 0.8rem; color: var(--muted); }
    .filter-row select, .filter-row input {
      background: var(--surface); color: var(--text); border: 1px solid var(--border);
      padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.85rem; }
    #loading { color: var(--muted); padding: 2rem; text-align: center; }
    #error { color: var(--red); padding: 2rem; text-align: center; display: none; }
    .count { color: var(--muted); font-size: 0.8rem; margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <h1>ğŸ§™â€â™‚ï¸ SysMLcheap â€” Model Tables</h1>
  <p class="subtitle">Live from YAML Â· auto-updates on every page load</p>

  <nav id="tabs"></nav>

  <div class="filter-row">
    <label>Status: </label>
    <select id="statusFilter">
      <option value="all">All</option>
      <option value="mvp">MVP</option>
      <option value="future">Future</option>
    </select>
    <label>Search: </label>
    <input id="search" type="text" placeholder="filter by name or idâ€¦" />
  </div>

  <div class="count" id="count"></div>
  <div id="loading">Loading model dataâ€¦</div>
  <div id="error"></div>
  <div id="tableWrap"></div>

  <script>
    // â”€â”€ Config: define table types here â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Each entry: { id, label, file, key, columns: [{header, field, class?, render?}] }
    const REPO_OWNER = 'pixel7777';
    const REPO_NAME  = 'SysMLcheap';
    const BRANCH     = 'main';
    const BASE_RAW   = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${BRANCH}`;

    const TABLES = [
      {
        id: 'actors',
        label: 'Actors',
        file: 'model/behavioral.yaml',
        key: 'actors',
        columns: [
          { header: 'Name',     field: 'name' },
          { header: 'ID',       field: 'id',     cls: 'id' },
          { header: 'Status',   field: 'status', render: statusBadge },
          { header: 'Owner',    field: 'ownerRef', cls: 'id' },
          { header: 'Use Cases',   field: 'useCaseRefs', render: refList },
          { header: 'Realized By', field: 'realizedByRefs', render: refList },
          { header: 'Documentation', field: 'documentation', cls: 'doc' },
        ]
      }
      // Add more table definitions here as needed
    ];

    // â”€â”€ Renderers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function statusBadge(val) {
      const v = (val || 'unknown').toLowerCase();
      return `<span class="status status-${v}">${v}</span>`;
    }
    function refList(val) {
      if (!val || !Array.isArray(val) || val.length === 0) return '<span style="color:var(--muted)">â€”</span>';
      return val.map(r => `<code>${r}</code>`).join(', ');
    }

    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentTable = TABLES[0].id;
    let yamlCache = {};

    // â”€â”€ Build tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const tabsEl = document.getElementById('tabs');
    TABLES.forEach(t => {
      const btn = document.createElement('button');
      btn.textContent = t.label;
      btn.dataset.id = t.id;
      btn.onclick = () => { currentTable = t.id; renderAll(); };
      tabsEl.appendChild(btn);
    });

    // â”€â”€ Fetch & render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchYaml(file) {
      if (yamlCache[file]) return yamlCache[file];
      const url = `${BASE_RAW}/${file}`;
      const resp = await fetch(url);
      if (!resp.ok) throw new Error(`Failed to fetch ${file}: ${resp.status}`);
      const text = await resp.text();
      const data = jsyaml.load(text);
      yamlCache[file] = data;
      return data;
    }

    function renderAll() {
      // highlight active tab
      tabsEl.querySelectorAll('button').forEach(b =>
        b.classList.toggle('active', b.dataset.id === currentTable));
      loadTable(TABLES.find(t => t.id === currentTable));
    }

    async function loadTable(tableDef) {
      const wrap = document.getElementById('tableWrap');
      const loading = document.getElementById('loading');
      const errEl = document.getElementById('error');
      const countEl = document.getElementById('count');
      wrap.innerHTML = ''; errEl.style.display = 'none'; loading.style.display = 'block';

      try {
        const data = await fetchYaml(tableDef.file);
        let rows = data[tableDef.key] || [];

        // filters
        const sf = document.getElementById('statusFilter').value;
        if (sf !== 'all') rows = rows.filter(r => (r.status || '').toLowerCase() === sf);
        const q = document.getElementById('search').value.toLowerCase().trim();
        if (q) rows = rows.filter(r =>
          (r.name || '').toLowerCase().includes(q) || (r.id || '').toLowerCase().includes(q));

        loading.style.display = 'none';
        countEl.textContent = `${rows.length} item${rows.length !== 1 ? 's' : ''}`;

        const table = document.createElement('table');
        const thead = document.createElement('thead');
        const hr = document.createElement('tr');
        tableDef.columns.forEach(c => { const th = document.createElement('th'); th.textContent = c.header; hr.appendChild(th); });
        thead.appendChild(hr); table.appendChild(thead);

        const tbody = document.createElement('tbody');
        rows.forEach(row => {
          const tr = document.createElement('tr');
          tableDef.columns.forEach(c => {
            const td = document.createElement('td');
            if (c.cls) td.classList.add(c.cls);
            const val = row[c.field];
            if (c.render) { td.innerHTML = c.render(val); }
            else { td.textContent = val ?? 'â€”'; }
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        wrap.appendChild(table);
      } catch (e) {
        loading.style.display = 'none';
        errEl.style.display = 'block';
        errEl.textContent = `Error: ${e.message}`;
      }
    }

    // â”€â”€ Filter listeners â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('statusFilter').addEventListener('change', () => { yamlCache = {}; renderAll(); });
    document.getElementById('search').addEventListener('input', () => { yamlCache = {}; renderAll(); });

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    renderAll();
  </script>
</body>
</html>
