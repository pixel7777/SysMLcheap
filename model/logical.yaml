# ============================================================================
# LOGICAL ARCHITECTURE — System Context & Logical Blocks
# Variant in focus: MVP Single-User
# ============================================================================

blocks:
  # --- Logical System Context (MVP Single-User) ---
  - id: blk_log_context_mvp_single_user
    name: Language Quest System Context (MVP Single-User)
    documentation: >
      Top-level logical context for the MVP single-user configuration.
      Contains the system-of-interest and required external entities that
      interact through defined logical interfaces.
    stereotype: context
    ownerRef: pkg_logical
    status: mvp
    parts:
      - id: pp_log_system_mvp_single_user
        name: language quest system (mvp)
        typeRef: blk_log_system_mvp_single_user
        realizationRefs:
          - uc_access_application
          - uc_learn_language
          - uc_review_srs_session
          - uc_request_learning_explanation
          - uc_play_rpg
          - uc_understand_learning_progress
          - uc_maintain_system
          - uc_test_system

      # Option A: separate human external blocks by interface intent
      - id: pp_log_ext_learning_user
        name: learning user external
        typeRef: blk_log_ext_learning_user
        realizationRefs: [act_heidi]

      - id: pp_log_ext_operations_user
        name: operations user external
        typeRef: blk_log_ext_operations_user
        realizationRefs: [act_developer, act_tester, act_maintainer]

      - id: pp_log_ext_ai_provider
        name: ai provider external
        typeRef: blk_log_ext_ai_provider
        realizationRefs: [act_ai_provider]

      - id: pp_log_ext_host_platform
        name: host platform external
        typeRef: blk_log_ext_host_platform
        realizationRefs: [act_host_platform]

      - id: pp_log_ext_test_bench
        name: test bench external
        typeRef: blk_log_ext_test_bench
        realizationRefs: [act_test_bench]

    ports: []  # Context blocks may not own ports

  # --- External Blocks (MVP) ---
  - id: blk_log_ext_learning_user
    name: Learning User External
    documentation: >
      Human interacting with learner-facing gameplay and learning interfaces.
      Represents user-to-system interaction needs, not implementation technology.
    stereotype: external
    ownerRef: pkg_logical
    status: mvp
    ports:
      - id: port_ext_learning_ui
        name: learning ui
        typeRef: ib_log_learning_ui
        conjugated: false

  - id: blk_log_ext_operations_user
    name: Operations User External
    documentation: >
      Human performing maintenance, testing, and administrative interactions
      via operations-focused interfaces.
    stereotype: external
    ownerRef: pkg_logical
    status: mvp
    ports:
      - id: port_ext_ops_ui
        name: operations ui
        typeRef: ib_log_operations_ui
        conjugated: false

  - id: blk_log_ext_ai_provider
    name: AI Provider External
    documentation: >
      External AI model service used for generation and analysis tasks.
    stereotype: external
    ownerRef: pkg_logical
    status: mvp
    ports:
      - id: port_ext_ai_api
        name: ai api
        typeRef: ib_log_ai_interface
        conjugated: true

  - id: blk_log_ext_host_platform
    name: Host Platform External
    documentation: >
      External hosting/runtime platform providing deployment and operational
      platform services to the system.
    stereotype: external
    ownerRef: pkg_logical
    status: mvp
    ports:
      - id: port_ext_platform_services
        name: platform services
        typeRef: ib_log_platform_services
        conjugated: true

  - id: blk_log_ext_test_bench
    name: Test Bench External
    documentation: >
      External automated test infrastructure that invokes test execution and
      receives test outcomes.
    stereotype: external
    ownerRef: pkg_logical
    status: mvp
    ports:
      - id: port_ext_test_harness
        name: test harness
        typeRef: ib_log_test_harness
        conjugated: true

  # --- Logical System Block (MVP Single-User) ---
  - id: blk_log_system_mvp_single_user
    name: Language Quest System (MVP Single-User)
    documentation: >
      Top-level logical SOI for the MVP single-user configuration.
      System-level behavior and functions will be defined here before
      any subsystem partitioning is introduced.
    stereotype: logical
    ownerRef: pkg_logical
    status: mvp
    operations:
      - id: op_request_application_entry
        name: requestApplicationEntry
        documentation: >
          Accept an application entry request from a user browser session
          and initiate the access sequence.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_request_application_entry_in
            name: entry request
            direction: in
            typeRef: sig_app_entry_request
          - id: par_op_request_application_entry_out
            name: entry response
            direction: out
            typeRef: sig_app_entry_response

      - id: op_evaluate_access_gate_requirement
        name: evaluateAccessGateRequirement
        documentation: >
          Determine whether local MVP access gating is required for the
          incoming session context.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_evaluate_access_gate_requirement_in
            name: entry request
            direction: in
            typeRef: sig_app_entry_request
          - id: par_op_evaluate_access_gate_requirement_out
            name: gate decision
            direction: out
            typeRef: sig_access_gate_decision

      - id: op_validate_local_access_credential
        name: validateLocalAccessCredential
        documentation: >
          Validate locally managed access credential for MVP single-user access.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_validate_local_access_credential_in
            name: local credential
            direction: in
            typeRef: sig_local_access_credential
          - id: par_op_validate_local_access_credential_out
            name: credential result
            direction: out
            typeRef: sig_credential_validation_result

      - id: op_establish_learner_session
        name: establishLearnerSession
        documentation: >
          Establish a trusted local learner session after successful access
          gate evaluation and credential validation.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_establish_learner_session_in
            name: credential result
            direction: in
            typeRef: sig_credential_validation_result
          - id: par_op_establish_learner_session_out
            name: learner session
            direction: out
            typeRef: sig_learner_session

      - id: op_load_mvp_static_configuration
        name: loadMvpStaticConfiguration
        documentation: >
          Load static MVP learner configuration values used to initialize
          learner-facing views and defaults.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_load_mvp_static_configuration_in
            name: learner session
            direction: in
            typeRef: sig_learner_session
          - id: par_op_load_mvp_static_configuration_out
            name: mvp configuration snapshot
            direction: out
            typeRef: sig_mvp_configuration_snapshot

      - id: op_load_current_stories
        name: loadCurrentStories
        documentation: >
          Retrieve available and resumable story records for the learner.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_load_current_stories_in
            name: learner session
            direction: in
            typeRef: sig_learner_session
          - id: par_op_load_current_stories_out
            name: current story summary
            direction: out
            typeRef: sig_current_story_summary

      - id: op_load_learner_progress_summary
        name: loadLearnerProgressSummary
        documentation: >
          Retrieve learner progress summary needed for main learner UI
          initialization.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_load_learner_progress_summary_in
            name: learner session
            direction: in
            typeRef: sig_learner_session
          - id: par_op_load_learner_progress_summary_out
            name: learner progress summary
            direction: out
            typeRef: sig_learner_progress_summary

      - id: op_render_learner_home_view
        name: renderLearnerHomeView
        documentation: >
          Compose and present the learner home view model using configuration,
          story, and progress data.
        ownerRef: blk_log_system_mvp_single_user
        parameters:
          - id: par_op_render_learner_home_view_cfg
            name: mvp configuration snapshot
            direction: in
            typeRef: sig_mvp_configuration_snapshot
          - id: par_op_render_learner_home_view_story
            name: current story summary
            direction: in
            typeRef: sig_current_story_summary
          - id: par_op_render_learner_home_view_progress
            name: learner progress summary
            direction: in
            typeRef: sig_learner_progress_summary
          - id: par_op_render_learner_home_view_out
            name: learner home view model
            direction: out
            typeRef: sig_learner_home_view_model
    ports:
      - id: port_sys_learning_ui
        name: learning ui
        typeRef: ib_log_learning_ui
        conjugated: true
      - id: port_sys_operations_ui
        name: operations ui
        typeRef: ib_log_operations_ui
        conjugated: true
      - id: port_sys_ai
        name: ai
        typeRef: ib_log_ai_interface
        conjugated: false
      - id: port_sys_platform_services
        name: platform services
        typeRef: ib_log_platform_services
        conjugated: false
      - id: port_sys_test_harness
        name: test harness
        typeRef: ib_log_test_harness
        conjugated: false

# ============================================================================
# INTERFACE BLOCKS & SIGNALS — Logical interfaces
# ============================================================================

interfaceBlocks:
  - id: ib_log_learning_ui
    name: Learning UI
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_lui_app_entry_request
        name: app entry request
        direction: inout
        typeRef: sig_app_entry_request
      - id: fp_lui_app_entry_response
        name: app entry response
        direction: out
        typeRef: sig_app_entry_response
      - id: fp_lui_local_access_credential
        name: local access credential
        direction: inout
        typeRef: sig_local_access_credential
      - id: fp_lui_learner_home_view
        name: learner home view model
        direction: out
        typeRef: sig_learner_home_view_model
      - id: fp_lui_player_input
        name: player input
        direction: inout
        typeRef: sig_player_input
      - id: fp_lui_narrative
        name: narrative output
        direction: out
        typeRef: sig_narrative_output
      - id: fp_lui_mc_options
        name: multiple choice options
        direction: out
        typeRef: sig_mc_options

  - id: ib_log_operations_ui
    name: Operations UI
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_oui_ops_command
        name: operations command
        direction: inout
        typeRef: sig_operations_command
      - id: fp_oui_ops_status
        name: operations status
        direction: out
        typeRef: sig_operations_status

  - id: ib_log_ai_interface
    name: AI Interface
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_ai_prompt
        name: prompt
        direction: out
        typeRef: sig_ai_prompt
      - id: fp_ai_response
        name: response
        direction: inout
        typeRef: sig_ai_response

  - id: ib_log_platform_services
    name: Platform Services
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_ps_deploy_request
        name: deploy request
        direction: out
        typeRef: sig_deploy_request
      - id: fp_ps_runtime_telemetry
        name: runtime telemetry
        direction: inout
        typeRef: sig_runtime_telemetry

  - id: ib_log_test_harness
    name: Test Harness
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_th_test_request
        name: test request
        direction: out
        typeRef: sig_test_request
      - id: fp_th_test_result
        name: test result
        direction: inout
        typeRef: sig_test_result

  - id: ib_log_language_services
    name: Language Services
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_ls_vocab_query
        name: vocabulary query
        direction: inout
        typeRef: sig_vocab_query
      - id: fp_ls_assessment
        name: assessment result
        direction: out
        typeRef: sig_assessment_result

signals:
  - id: sig_app_entry_request
    name: App Entry Request
    documentation: >
      Request from a browser client to access the application entry point
      at the configured URL.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_app_entry_response
    name: App Entry Response
    documentation: >
      Initial application response indicating access gate state and next
      action for session establishment.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_access_gate_decision
    name: Access Gate Decision
    documentation: >
      Decision indicating whether local access credential validation is
      required for this session.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_local_access_credential
    name: Local Access Credential
    documentation: >
      Locally managed MVP credential submitted to pass the access gate.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_credential_validation_result
    name: Credential Validation Result
    documentation: >
      Result of local credential validation including success/failure
      outcome and reason code.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_learner_session
    name: Learner Session
    documentation: >
      Trusted local session context representing successful learner access.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_mvp_configuration_snapshot
    name: MVP Configuration Snapshot
    documentation: >
      Effective static MVP learner configuration values loaded at access time.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_current_story_summary
    name: Current Story Summary
    documentation: >
      Summary of available and resumable stories presented on learner entry.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_learner_progress_summary
    name: Learner Progress Summary
    documentation: >
      Summary of learner progress state needed for home view initialization.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_learner_home_view_model
    name: Learner Home View Model
    documentation: >
      Composed learner-facing home view data including configuration,
      current stories, and progress snapshot.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_player_input
    name: Player Input
    documentation: >
      Input from the learner — either a multiple choice selection
      or free-text Croatian input. Includes metadata about input type.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_narrative_output
    name: Narrative Output
    documentation: >
      AI-generated narrative content in Croatian, ready for display
      to the learner. May include scene descriptions, NPC dialogue,
      and action results.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_mc_options
    name: Multiple Choice Options
    documentation: >
      A set of Croatian-language options for the learner to choose from.
      Always includes a free-text alternative option.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_operations_command
    name: Operations Command
    documentation: >
      Operational command/request issued by operations user for maintenance,
      testing control, configuration, or diagnostics.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_operations_status
    name: Operations Status
    documentation: >
      Operational response, status, or diagnostic information returned to
      operations user from system operations interfaces.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_ai_prompt
    name: AI Prompt
    documentation: >
      Assembled prompt for the AI provider, including system instructions,
      context window (NovelCrafter-style), conversation history,
      and current learner proficiency data.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_ai_response
    name: AI Response
    documentation: >
      Raw response from the AI provider. Parsed into structured
      narrative content, vocabulary annotations, and assessment data.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_deploy_request
    name: Deploy Request
    documentation: >
      Request from system operations interface to platform for deployment,
      release, or operational control action.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_runtime_telemetry
    name: Runtime Telemetry
    documentation: >
      Platform-provided telemetry regarding application health, errors,
      resource usage, and runtime events.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_test_request
    name: Test Request
    documentation: >
      Request to execute automated test suites, scenarios, or verification runs.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_test_result
    name: Test Result
    documentation: >
      Test execution outcomes including pass/fail status, evidence, and logs.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_vocab_query
    name: Vocabulary Query
    documentation: >
      Request to the language engine for vocabulary data — current mastery
      levels, SRS-due items, or assessment of a specific word usage.
    ownerRef: pkg_logical
    status: mvp

  - id: sig_assessment_result
    name: Assessment Result
    documentation: >
      Result of evaluating a learner's response. Includes updated mastery
      levels, grammar exposure updates, and game point awards.
    ownerRef: pkg_logical
    status: mvp
