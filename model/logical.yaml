# ============================================================================
# LOGICAL ARCHITECTURE — System Context & Logical Blocks (sample)
# ============================================================================

blocks:
  # --- Logical System Context ---
  - id: blk_log_context
    name: Croatian Learning App Context
    documentation: >
      Top-level logical system context. Contains the learning app system
      and its external actors as part properties.
    stereotype: context
    ownerRef: pkg_logical
    parts:
      - id: pp_log_system
        name: learning app
        typeRef: blk_log_system
        realizationRefs: [uc_play_session, uc_review_vocab, uc_session_zero, uc_manage_codex, uc_view_progress]
      - id: pp_log_learner
        name: learner
        typeRef: blk_log_learner_ext
        realizationRefs: [act_learner]
      - id: pp_log_ai
        name: ai provider
        typeRef: blk_log_ai_ext
        realizationRefs: [act_ai_provider]
    ports: []  # Context blocks may not own ports

  # --- External Blocks ---
  - id: blk_log_learner_ext
    name: Learner
    documentation: >
      External block representing the human learner interacting with
      the system via a web browser.
    stereotype: external
    ownerRef: pkg_logical
    ports:
      - id: port_learner_ui
        name: ui
        typeRef: ib_log_user_interaction
        conjugated: false

  - id: blk_log_ai_ext
    name: AI Provider
    documentation: >
      External block representing the AI language model service.
      Receives prompts and returns generated content.
    stereotype: external
    ownerRef: pkg_logical
    ports:
      - id: port_ai_api
        name: api
        typeRef: ib_log_ai_interface
        conjugated: true

  # --- Logical System Block ---
  - id: blk_log_system
    name: Learning App
    documentation: >
      Top-level logical system block. Decomposes into the major
      functional subsystems of the Croatian learning application.
    stereotype: logical
    ownerRef: pkg_logical
    parts:
      - id: pp_game_engine
        name: game engine
        typeRef: blk_log_game_engine
      - id: pp_language_engine
        name: language engine
        typeRef: blk_log_language_engine
      - id: pp_ai_orchestrator
        name: ai orchestrator
        typeRef: blk_log_ai_orchestrator
      - id: pp_user_manager
        name: user manager
        typeRef: blk_log_user_manager
    ports:
      - id: port_sys_ui
        name: ui
        typeRef: ib_log_user_interaction
        conjugated: true
      - id: port_sys_ai
        name: ai
        typeRef: ib_log_ai_interface
        conjugated: false

  # --- Logical Subsystem Blocks ---
  - id: blk_log_game_engine
    name: Game Engine
    documentation: >
      Manages TTRPG gameplay mechanics: Lasers & Feelings dice resolution,
      character sheets, story state, session management, and the
      narrative interaction loop.
    stereotype: logical
    ownerRef: pkg_logical
    ports:
      - id: port_ge_lang
        name: language services
        typeRef: ib_log_language_services
        conjugated: false
      - id: port_ge_ai
        name: ai services
        typeRef: ib_log_ai_interface
        conjugated: false

  - id: blk_log_language_engine
    name: Language Engine
    documentation: >
      Core language learning subsystem. Manages vocabulary bins (mastery
      tracking), grammar bin (progressive introduction), SRS scheduling,
      and learner proficiency assessment.
    stereotype: logical
    ownerRef: pkg_logical
    ports:
      - id: port_le_svc
        name: language services
        typeRef: ib_log_language_services
        conjugated: true

  - id: blk_log_ai_orchestrator
    name: AI Orchestrator
    documentation: >
      Manages communication with the external AI provider. Handles prompt
      construction (NovelCrafter-style context assembly), token budget
      management, and response parsing.
    stereotype: logical
    ownerRef: pkg_logical
    ports:
      - id: port_ao_ai
        name: ai api
        typeRef: ib_log_ai_interface
        conjugated: false

  - id: blk_log_user_manager
    name: User Manager
    documentation: >
      Manages user accounts, authentication, preferences, and
      cross-story persistent data (language stats, story library).
    stereotype: logical
    ownerRef: pkg_logical

# ============================================================================
# INTERFACE BLOCKS & SIGNALS — Logical interfaces
# ============================================================================

interfaceBlocks:
  - id: ib_log_user_interaction
    name: User Interaction
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_ui_player_input
        name: player input
        direction: inout
        typeRef: sig_player_input
      - id: fp_ui_narrative
        name: narrative output
        direction: out
        typeRef: sig_narrative_output
      - id: fp_ui_mc_options
        name: multiple choice options
        direction: out
        typeRef: sig_mc_options

  - id: ib_log_ai_interface
    name: AI Interface
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_ai_prompt
        name: prompt
        direction: out
        typeRef: sig_ai_prompt
      - id: fp_ai_response
        name: response
        direction: inout
        typeRef: sig_ai_response

  - id: ib_log_language_services
    name: Language Services
    stereotype: logical
    ownerRef: pkg_logical
    flowProperties:
      - id: fp_ls_vocab_query
        name: vocabulary query
        direction: inout
        typeRef: sig_vocab_query
      - id: fp_ls_assessment
        name: assessment result
        direction: out
        typeRef: sig_assessment_result

signals:
  - id: sig_player_input
    name: Player Input
    documentation: >
      Input from the learner — either a multiple choice selection
      or free-text Croatian input. Includes metadata about input type.
    ownerRef: pkg_logical

  - id: sig_narrative_output
    name: Narrative Output
    documentation: >
      AI-generated narrative content in Croatian, ready for display
      to the learner. May include scene descriptions, NPC dialogue,
      and action results.
    ownerRef: pkg_logical

  - id: sig_mc_options
    name: Multiple Choice Options
    documentation: >
      A set of Croatian-language options for the learner to choose from.
      Always includes a free-text alternative option.
    ownerRef: pkg_logical

  - id: sig_ai_prompt
    name: AI Prompt
    documentation: >
      Assembled prompt for the AI provider, including system instructions,
      context window (NovelCrafter-style), conversation history,
      and current learner proficiency data.
    ownerRef: pkg_logical

  - id: sig_ai_response
    name: AI Response
    documentation: >
      Raw response from the AI provider. Parsed into structured
      narrative content, vocabulary annotations, and assessment data.
    ownerRef: pkg_logical

  - id: sig_vocab_query
    name: Vocabulary Query
    documentation: >
      Request to the language engine for vocabulary data — current mastery
      levels, SRS-due items, or assessment of a specific word usage.
    ownerRef: pkg_logical

  - id: sig_assessment_result
    name: Assessment Result
    documentation: >
      Result of evaluating a learner's response. Includes updated mastery
      levels, grammar exposure updates, and game point awards.
    ownerRef: pkg_logical
